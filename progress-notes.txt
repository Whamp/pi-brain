# Code Review Fix Progress

Branch: fix/code-review-20260127-092619
Created: 2026-01-27 09:26
Main branch: major/pi-brain

## Issues to Fix

1. [P2] src/storage/node-repository.ts:234-268 - UPDATE statement missing source fields
   - upsertNode UPDATE doesn't update session_file, segment_start, segment_end, computer
   - These are intentionally immutable (ID is deterministic from these values)
   - Add comment explaining why they're omitted

2. [P3] src/storage/node-repository.ts:269-274 - Repeated db.prepare calls
   - DELETE statements call db.prepare() separately for each table
   - Cache these prepared statements like insertTag/insertTopic

3. [P3] src/storage/node-types.ts:38-42 - Input encoding not normalized
   - Uses ":" as separator which could theoretically collide
   - Use length-prefix encoding for robustness

---
