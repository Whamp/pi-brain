# Code Review Fix Progress

Branch: fix/code-review-20260127-192539
Created: 2026-01-27 19:25
Main branch: major/pi-brain

## Issues to Fix

### P1: Race condition on initial mount
- File: src/web/app/src/routes/+layout.svelte:53-63
- Problem: Subscription runs synchronously with initial state `{ connected: false, reconnecting: false }`, 
  triggering `startPolling()` immediately before WebSocket has a chance to connect.
- Fix: Skip the first emission from the subscription (initial state).

### P2: Redundant condition branches
- File: src/web/app/src/routes/+layout.svelte:53-63  
- Problem: Two branches both call `startPolling()` - confusing even if guarded.
- Fix: Simplify to `if (connected) { stopPolling() } else { startPolling() }`.

### P3: Missing finally block for loading cleanup
- File: src/web/app/src/lib/stores/daemon.ts:38-53
- Problem: If fetchStatus throws before catch, loading remains true.
- Fix: Use finally block to ensure loading is always reset.

---

## 2026-01-27 19:31 - Task 16.4

**Status**: pending â†’ done
**Validation**: 
- svelte-check passes (0 errors, 0 warnings)
- All 1217 tests pass
- Lint/format checks pass
- Dev server builds and serves correctly
**Commit**: eca722fa
**Notes**: Implemented undo window for News Feed confirm/dismiss actions:
- Added 5-second undo delay before API call
- Visual pending state with "Confirmed" or "Dismissed" label
- Undo button to cancel pending action
- Animated timer bar showing remaining time
- Proper cleanup of timeouts on component destroy
- Responsive mobile layout for undo UI
