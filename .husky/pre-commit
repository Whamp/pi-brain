#!/bin/sh
set -e

# Check if there are any staged files
if [ -z "$(git diff --cached --name-only)" ]; then
  echo "No staged files to check"
  exit 0
fi

# Secret scanning (staged files only) - fast, runs first
echo "üîê Scanning for secrets..."
if command -v gitleaks >/dev/null 2>&1; then
  gitleaks protect --staged --config .gitleaks.toml
else
  echo "‚ö†Ô∏è  gitleaks not installed, skipping secret scan"
fi

# Run full validation stack (build, format, lint, deadcode, duplicates, tests)
npm run validate

# Refresh codemap documentation
./scripts/refresh-codemap.sh
