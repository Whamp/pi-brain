#!/bin/sh
# Exit on any error
set -e

# Check if there are any staged files
if [ -z "$(git diff --cached --name-only)" ]; then
  echo "No staged files to check"
  exit 0
fi

# Run linter check (no auto-fix - fail fast if issues found)
npx ultracite check
CHECK_EXIT_CODE=$?

if [ $CHECK_EXIT_CODE -ne 0 ]; then
  echo "Linting failed. Run 'npm run fix && npx oxfmt --write .' to fix issues."
  exit $CHECK_EXIT_CODE
fi

# Run tests (with --run to avoid watch mode)
npm test -- --run
